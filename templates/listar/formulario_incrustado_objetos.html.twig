{% extends 'base.html.twig' %}

{% block title %}Hello ContactController!{% endblock %}

{% block body %}

<script>

window.onload = function(){
    
    // on submit
    let formulario = document.querySelector("#formulario-incrustado-objetos_id");
    formulario.onsubmit = function(){
        return validar(formulario);
    };
    console.log("cargado"+formulario);

    // listener button
    document
        .querySelectorAll('.add_item_link')
        .forEach(btn => {
            btn.addEventListener("click", addFormToCollection)
        });
}


const addFormToCollection = (e) => {
  
  const collectionHolder = document.querySelector('.' + e.currentTarget.dataset.collectionHolderClass);
  const item = document.createElement('li');
  console.log(e.currentTarget.dataset); 
   
    
  item.innerHTML = collectionHolder
    .dataset
    .prototype
    .replace(/__name__/g,collectionHolder.dataset.index);

  collectionHolder.appendChild(item);
  collectionHolder.dataset.index++;
  

};


function validar(formulario){
    let nuevo_pais_textarea_desciption = document.querySelector("#nuevo_pais_textarea_desciption");
    if (nuevo_pais_textarea_desciption.value == ""){
        console.log("Enviamos false nuevo_pais_textarea_desciption es blanco");
        return false;
    }else{
        return true;
    }
}
</script>

    <h1>Contact us</h1>
    <p>This is a simple contact form</p>
    {#, 'onSubmit':'return validar();' #}
    {{ form_start(form, {'action': path('formulario-incrustado-objetos'), 'method': 'POST', 'attr':{'id':'formulario-incrustado-objetos_id' , 'name':'formulario-incrustado-objetos' } })  }}
    {{ form_row(form.textTitle) }}
    {{ form_row(form.status) }}
    {{ form_row(form.position) }}
    {{ form_row(form.updateAt) }}
    <ul class="dynamicGeoregion" data-index="{{ form.dynamicGeoregion|length > 0 ? form.dynamicGeoregion|last.vars.name + 1 : 0 }}"
    data-prototype="{{ form_widget(form.dynamicGeoregion.vars.prototype)|e('html_attr') }}">
    {% for region in form.dynamicGeoregion %}
        <li>{{ form_row(region.textTitle) }}</li>
    {% endfor %}
    </ul>
    <button type="button" class="add_item_link" data-collection-holder-class="dynamicGeoregion">Add a dynamicGeoregion</button>
    {{ form_errors(form) }}
    {{ form_help(form) }}
    {{ form_rest(form) }}
    {{ form_end(form) }}

    {% for message in app.flashes('success') %}
        <div class="alert alert-success">
            {{ message }}
        </div>
    {% endfor %}

{% endblock %}